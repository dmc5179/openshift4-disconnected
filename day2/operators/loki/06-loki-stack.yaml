apiVersion: loki.grafana.com/v1
kind: LokiStack
metadata:
  name: logging-loki 
  namespace: openshift-logging 
spec:
# Commented out fields have not yet been tested. Need to understand how often it will write to S3
  limits:
    ingestion:
      ingestionBurstSize: 16
      ingestionRate: 8
#      maxGlobalStreamsPerTenant:
#      maxLabelNameLength:
#      maxLabelNamesPerSeries:
#      maxLabelValueLength:
#      maxLineSize:
#      perStreamDesiredRate:
      perStreamRateLimit: 5 # This number MUST be smaller than ingestionRate
      perStreamRateLimitBurst: 15 # This number MUST be smaller than ingestionBurstSize
    global:
      retention:
        days: 20
    tenants:  1 
      application:
        retention:
          days: 5
          streams:
            - days: 1
              selector: '{kubernetes_namespace_name=~"tenant.*"}'
      infrastructure:
        retention:
          days: 5
          streams:
            - days: 1
              selector: '{kubernetes_namespace_name=~"openshift.*"}'
  managementState: Managed
  replication:
    factor: 1 # Default is 1
  size: 1x.small
  storage:
    schemas:
    - version: v13
      effectiveDate: "2025-09-16" #Set to yesterday's date to take effect
    secret:
      name: logging-loki-s3 
      type: s3 
  storageClassName: gp3-csi # block storage
  tenants:
    mode: openshift-logging
