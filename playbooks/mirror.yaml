---
- hosts: mirror_server
  gather_facts: true
  become: false
  tasks:

    - name: Mirror Additional Tools
      include_role:
        name: tools
        apply:
          tags:
            - mirror
      when: (mirror_tools | bool)

    # Need the oc client for other mirror roles
    - name: Install OpenShift Client
      include_role:
        name: tools
        apply:
          tags:
            - install
      when: (mirror_tools | bool)

    - name: Mirror Additional Images
      import_role:
        name: mirror_images
      when: (mirror_images | bool)

    - name: Standup Mirror Docker Registry
      include_role:
        name: podman_registry
      when:
        (mirror_ocp_images | bool) or
        (mirror_operatorhub_images | bool)
        (mirror_images | bool)

    - name: Mirror OpenShift Cluster Images
      import_role:
        name: mirror_ocp_images
      when: (mirror_ocp_images | bool)

    - name: Mirror Operator Hub Images
      import_role:
        name: mirror_operatorhub_images
      when: (mirror_operatorhub_images | bool)

    - name: Mirror RPM Repositories
      import_role:
        name: mirror_rpms
      when: (mirror_rpms | bool)

    - name: Mirror RHCOS
      import_role:
        name: mirror_rhcos
      when: (mirror_rhcos | bool)

    - name: Mirror helm binary and charts
      include_role:
        name: helm
        apply:
          tags:
            - mirror
