---
- hosts: mirror_server
  gather_facts: true
  become: false
  tasks:

    - name: Mirror Additional Tools
      include_role:
        name: tools
        apply:
          tags:
            - mirror
      when: (mirror_tools | bool)
      tags:
        - mirror_tools

    # Need the oc client for other mirror roles
    - name: Install OpenShift Client
      include_role:
        name: tools
        apply:
          tags:
            - install
      when: (mirror_tools | bool)
      tags:
        - install_tools

    - name: Mirror Additional Images
      import_role:
        name: mirror_images
      when: (mirror_images | bool)
      tags:
        - mirror_additional_images

    - name: Standup Mirror Docker Registry
      import_role:
        name: podman_registry
      when:
        (mirror_ocp_images | bool) or
        (mirror_operatorhub_images | bool) or
        (mirror_images | bool)
      tags:
        - install_registry

    - name: Mirror OpenShift Cluster Images
      import_role:
        name: mirror_ocp_images
      when: (mirror_ocp_images | bool)
      tags:
        - mirror_ocp_images

# TODO: This has a bug in it
#    - name: Mirror Operator Hub Images
#      import_role:
#        name: mirror_operatorhub_images
#      when: (mirror_operatorhub_images | bool)
#      tags:
#        - mirror_operatorhub_images

    - name: Mirror RPM Repositories
      import_role:
        name: mirror_rpms
      when: (mirror_rpms | bool)
      tags:
        - mirror_rpms

    - name: Mirror RHCOS
      import_role:
        name: mirror_rhcos
      when: (mirror_rhcos | bool)
      tags:
        - mirror_rhcos

    - name: Mirror helm binary and charts
      include_role:
        name: helm
        apply:
          tags:
            - mirror
      tags:
        - mirror_helm
