---
# tasks file for mirror_operatorhub_images

- name: Create redhat-operators catalog image
  become: "{{ run_as_root }}"
  shell:
    cmd: "{{ oc_cmd }} adm catalog build --insecure --appregistry-org redhat-operators --to={{ rh_op_repo }} --registry-config={{ local_secret_json }}"
    executable: /bin/bash
  when: (redhat_operators | bool)

- name: Mirror redhat-operators images
  become: "{{ run_as_root }}"
  shell:
    cmd: "{{ oc_cmd }} adm catalog mirror {{ rh_op_repo }} {{ mirror_transport }}://{{ mirror_registry }} -a {{ local_secret_json }} --insecure"
    executable: /bin/bash
  when: (redhat_operators | bool)

- name: Create certified-operators catalog image
  become: "{{ run_as_root }}"
  shell:
    cmd: "{{ oc_cmd }} adm catalog build --appregistry-org certified-operators --to={{ supp_op_repo }} --registry-config={{ local_secret_json }}"
    executable: /bin/bash
  when: (supported_operators | bool)

- name: Mirror certified-operators images
  become: "{{ run_as_root }}"
  shell:
    cmd: "{{ oc_cmd }} adm catalog mirror {{ supp_op_repo }} {{ mirror_transport }}://{{ mirror_registry }} -a {{ local_secret_json }} --insecure"
    executable: /bin/bash
  when: (supported_operators | bool)

- name: Create community-operators catalog image
  become: "{{ run_as_root }}"
  shell:
    cmd: "{{ oc_cmd }} adm catalog build --appregistry-org community-operators --to={{ comm_op_repo }} --registry-config={{ local_secret_json }}"
    executable: /bin/bash
  when: (community_operators | bool)

- name: Mirror community-operators images
  become: "{{ run_as_root }}"
  shell:
    cmd: "{{ oc_cmd }} adm catalog mirror {{ comm_op_repo }} {{ mirror_transport }}://{{ mirror_registry }} -a {{ local_secret_json }} --insecure"
    executable: /bin/bash
  when: (community_operators | bool)
