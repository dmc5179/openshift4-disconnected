---
# tasks file for mirror_images

- name: Install skopeo
  become: true
  package:
    name: skopeo
    state: present

- name: Create additional image directory
  become: true
  file:
    path: "{{ mirror_base }}/additional_images"
    state: directory

- name: Mirror additional container images
  become: true
  shell:
    cmd: |

        rm -f "{{ mirror_base }}/additional_images/{{ ( item | replace(':','_') | replace('/','-') ) }}.tar"
        skopeo copy "docker://{{ item }}" "docker-archive://{{ mirror_base }}/additional_images/{{ ( item | replace(':','_') | replace('/','-') ) }}.tar"

    executable: /bin/bash
  with_items:
    - "{{ images }}"
