---
- name: Check if redis exists
  become: true
  shell:
    cmd: podman ps | grep '{{ redis_container_name }}'
  ignore_errors: true
  register: redis_info

- name: Create redis directory
  become: true
  file:
    path: '{{ redis_dir }}'
    state: directory
    owner: root
    group: root
    mode: '0777'
  when:
    - (redis_info.rc != 0)

- name: launching redis container
  become: true
  command: >
    podman run --detach \
    --restart=always -p 6379:6379 \
    --privileged=true \
    --name {{ redis_container_name }} \
    -v /var/lib/redis:/var/lib/redis/data:Z \
    registry.access.redhat.com/rhscl/redis-32-rhel7
  when:
    - (redis_info.rc != 0)
