---

- name: Create DNS Zone
  ipa_dnszone:
    ipa_host: '{{ ipa_host }}'
    ipa_pass: '{{ ipa_password }}'
    state: present
    zone_name: '{{ ocp_cluster_name }}.{{ ocp_base_domain }}'
    dynamicupdate: true

- name: Create OpenShift A Records
  ipa_dnsrecord:
    name: '{{ item.name }}'
    zone_name: '{{ ocp_cluster_name }}.{{ ocp_base_domain }}'
    record_type: 'AAAA'
    record_value: '{{ item.ip }}'
    record_ttl: 300
    ipa_host: '{{ ipa_host }}'
    ipa_pass: '{{ ipa_password }}'
    state: present
  with_items:
    - '{{ openshift_bootstrap }}'
    - '{{ openshift_masters }}'
    - '{{ openshift_workers }}'

- name: Create OpenShift SRV records
  ipa_dnsrecord:
    ipa_host: '{{ ipa_host }}'
    ipa_pass: '{{ ipa_password }}'
    state: present
    zone_name: '{{ ocp_cluster_name }}.{{ ocp_base_domain }}'
    record_name: '_etcd-server-ssl._tcp.{{ ocp_cluster_name }}'
    record_type: 'SRV'
    record_value: '10 0 2380 etcd-{{ idx }}.{{ ocp_cluster_name }}.{{ dns_zone_two }}.'
  with_items:
    - '{{ openshift_masters }}'
  loop_control:
    index_var: idx
