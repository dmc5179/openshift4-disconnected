---
- name: Base64 encode append-bootstrap
  slurp:
    src: "/var/www/html/ignition/append-bootstrap.ign"
  register: append_bootstrap

- vmware_deploy_ovf:
    hostname: '{{ vcenter_hostname }}'
    username: '{{ vcenter_username }}'
    password: '{{ vcenter_password }}'
    datacenter: '{{ datacenter_name }}'
#    cluster: Cluster1
    datastore: '{{ datastore_name }}'
    name: 'caas-bootstrap'
    disk_provisioning: thin
#    folder: '{{ datacenter_name }}'
#    networks: "{u'ocp_pg':u'{{ ProvisioningNetworkLabel }}'}"
    networks:
      "Network 1": "ocp_pg"
#      - name: '{{ portgroup_name }}'
#        ip: '10.0.106.50'
#        netmask: '255.255.255.0'
#        device_type: vmxnet3
    validate_certs: "{{ ssl_enabled }}"
    power_on: false
#    ovf: '/caas/rhcos-4.3.8-x86_64-vmware.x86_64.ova'
    ovf: '/opt/openshift/rhcos/rhcos-4.3.8-x86_64-vmware.x86_64.ova'
    properties:
      guestinfo.ignition.config.data: '{{ append_bootstrap.content }}'
      guestinfo.ignition.config.data.encoding: 'base64'
      guestinfo.hostname: 'bootstrap.caas.redhatgovic.io'
      guestinfo.interface.0.name: 'ens192'
      guestinfo.interface.0.dhcp: 'no'
      guestinfo.interface.0.role: 'public'
      guestinfo.interface.0.ip.0.address: '10.0.106.50/24'
      guestinfo.interface.0.route.0.gateway: '10.0.106.1'
      guestinfo.interface.0.route.0.destination: '0.0.0.0/0'
      guestinfo.dns.server.0: '10.0.106.42'
      disk.EnableUUID: true
  delegate_to: localhost
