---
# tasks file for modify_ignition

- name: Customize bootstrap ignition
  shell: 
    cmd: '{{filetranspiler}} -i {{ ignition_configs }}/bootstrap.ign -f {{ fake_root_base }}/bootstrap --format json > {{ ignition_configs }}/bootstrap_static.ign'
#    executable: python3
  register: bootstrap_static

- name: Replace original ignition
  copy:
    src: "{{ ignition_configs }}/bootstrap_static.ign"
    dest: "{{ ignition_configs }}/bootstrap.ign"
    remote_src: true
   
- name: Customize master ignition
  shell:
    cmd: '{{filetranspiler}} -i {{ ignition_configs }}/master.ign -f {{ fake_root_base }}/{{ item }} --format json > {{ ignition_configs }}/{{ item }}.ign'
  with_items:
    - 'master0'
    - 'master1'
    - 'master2'

- name: Customize worker ignition
  shell:
    cmd: '{{filetranspiler}} -i {{ ignition_configs }}/worker.ign -f {{ fake_root_base }}/{{ item }} --format json > {{ ignition_configs }}/{{ item }}.ign'
  with_items:
    - 'worker0'
    - 'worker1'
    - 'worker2'
